<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <title>CouchDB</title>
    <script type="text/javascript">
        function loadDoc() {
            var DATABASE = "/" + window.location.href.split("/")[3];
            //           function uploadHighscores() {
            //   var req = new XMLHttpRequest();
            //   req.open('PUT', DATABASE, true); // METHOD, url, async
            //   req.onload = function() { // Asynchronous callback.
            //     console.log(req.responseText);
            //     console.log("Scores uploaded");
            //   }
            //   req.setRequestHeader('Content-Type', 'application/json');
            //   console.log("Sending scores...");
            //
            //   req.send("{\"_id\": \"highscores\", \"_rev\": \"6-f29fd233a21c65e3f4a7485f36c46ae4\", \"data\":{\"scores\":[999, 999, 999, 999, 999], \"times\":[[59, 59, 999], [59, 59, 999], [59, 59, 999], [59, 59, 999], [59, 59, 999]]}}");
            // }
            // }

            var task = {
                "_id" : "123",
                "name": "abc",
                "userid": "a123",
                "age": 23
            };
            $.ajax({
                type: "POST",
                url: DATABASE,
                contentType: "application/json",
                data: JSON.stringify(task),
                success: "true"
            });


            $.ajax({
                type: "GET",
                url: DATABASE+"tasks",
                success: function(data) {
                    var view = JSON.parse(data);
                    var tasks = [];
                    $(view.rows).each(function(index, item) {
                        tasks.push(item.value);
                    });
                    displayTasks(tasks);
                }
            });

            function displayTasks(tasks) {
                var html = "<table>";
                $(tasks).each(function(index, task) {
                    var edit = "<input type='button' value='Edit' " +
                        "onclick='editTask(" + JSON.stringify(task) + ")' />";
                    var del = "<input type='button' value='Delete' " +
                        "onclick='deleteTask(" + JSON.stringify(task) + ")' />";

                    html += "<tr>";
                    html += "<td>" + task.task + "</td>";
                    html += "<td>" + edit + "</td>";
                    html += "<td>" + del + "</td>";
                    html += "</tr>";
                });
                html += "</table>";

                $('#tasks').empty();
                $('#tasks').append(html);
                $.ajax({
                    type: "PUT",
                    url: DATABASE + "/" + task._id,
                    contentType: "application/json",
                    data: JSON.stringify(task),
                    success: function () {
                        getTasks();
                    }
                 });
            }

            //         var DATABASE = "/" + window.location.href.split("/")[3];
            // var xhttp = new XMLHttpRequest();
            // xhttp.onreadystatechange = function() {
            //   if (this.readyState == 4 && this.status == 200) {
            //     document.getElementById("demo").innerHTML =
            //     this.responseText;
            //   }
            // };
            // xhttp.open("GET", "a.html" , true);
            // xhttp.send();
            // }
        }
    </script>
</head>

<body>
    <h1 onclick=" loadDoc()">Hello</h1>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</body>

</html>
